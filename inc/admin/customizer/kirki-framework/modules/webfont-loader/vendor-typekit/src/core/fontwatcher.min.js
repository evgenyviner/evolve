goog.provide("webfont.FontWatcher");goog.require("webfont.FontWatchRunner");goog.require("webfont.NativeFontWatchRunner");webfont.FontTestStrings;webfont.FontWatcher=function(c,b,a){this.domHelper_=c;this.eventDispatcher_=b;this.currentlyWatched_=0;this.last_=false;this.success_=false;this.timeout_=a};goog.scope(function(){var b=webfont.FontWatcher,a=webfont.FontWatchRunner,c=webfont.NativeFontWatchRunner;b.SHOULD_USE_NATIVE_LOADER=null;b.getUserAgent=function(){return window.navigator.userAgent};b.getVendor=function(){return window.navigator.vendor};b.shouldUseNativeLoader=function(){if(b.SHOULD_USE_NATIVE_LOADER===null){if(!!window.FontFace){var e=/Gecko.*Firefox\/(\d+)/.exec(b.getUserAgent());var d=/OS X.*Version\/10\..*Safari/.exec(b.getUserAgent())&&/Apple/.exec(b.getVendor());if(e){b.SHOULD_USE_NATIVE_LOADER=parseInt(e[1],10)>42}else{if(d){b.SHOULD_USE_NATIVE_LOADER=false}else{b.SHOULD_USE_NATIVE_LOADER=true}}}else{b.SHOULD_USE_NATIVE_LOADER=false}}return b.SHOULD_USE_NATIVE_LOADER};b.prototype.watchFonts=function(k,l,o,n){var e=k.length,h=l||{};if(e===0&&n){this.eventDispatcher_.dispatchInactive();return}this.currentlyWatched_+=k.length;if(n){this.last_=n}var j,d=[];for(j=0;j<k.length;j++){var f=k[j],g=h[f.getName()];this.eventDispatcher_.dispatchFontLoading(f);var m=null;if(b.shouldUseNativeLoader()){m=new c(goog.bind(this.fontActive_,this),goog.bind(this.fontInactive_,this),this.domHelper_,f,this.timeout_,g)}else{m=new a(goog.bind(this.fontActive_,this),goog.bind(this.fontInactive_,this),this.domHelper_,f,this.timeout_,o,g)}d.push(m)}for(j=0;j<d.length;j++){d[j].start()}};b.prototype.fontActive_=function(d){this.eventDispatcher_.dispatchFontActive(d);this.success_=true;this.decreaseCurrentlyWatched_()};b.prototype.fontInactive_=function(d){this.eventDispatcher_.dispatchFontInactive(d);this.decreaseCurrentlyWatched_()};b.prototype.decreaseCurrentlyWatched_=function(){if(--this.currentlyWatched_==0&&this.last_){if(this.success_){this.eventDispatcher_.dispatchActive()}else{this.eventDispatcher_.dispatchInactive()}}}});